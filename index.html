<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‡¦é‡æ”¹å–„ è³ƒä¸Šã’è£œåŠ©é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v4</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#F7F8FA;--card:#FFF;--text:#1A1D23;--text2:#5A6070;--text3:#8B92A3;
  --border:#E5E8EE;--border2:#D0D4DD;
  --kaigo:#0A6B5E;--kaigo-light:#E6F5F0;--kaigo-accent:#10B981;
  --shogai:#2563EB;--shogai-light:#EFF6FF;--shogai-accent:#60A5FA;
  --warn:#F59E0B;--warn-light:#FFFBEB;--warn-text:#92400E;
  --danger:#EF4444;--danger-light:#FEF2F2;
  --success:#10B981;--success-light:#ECFDF5;
  --purple:#7C3AED;--purple-light:#F5F3FF;
  --radius:10px;--shadow:0 1px 3px rgba(0,0,0,.06);
  --shadow2:0 4px 12px rgba(0,0,0,.08);
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);line-height:1.7;font-size:14px}
.wrap{max-width:880px;margin:0 auto;padding:12px}
.hdr{text-align:center;padding:28px 16px 20px;background:linear-gradient(135deg,#0A6B5E 0%,#2563EB 100%);color:#fff;border-radius:0 0 16px 16px;margin-bottom:20px}
.hdr h1{font-size:20px;font-weight:700;letter-spacing:.3px}
.hdr .sub{font-size:11px;opacity:.75;margin-top:4px}
.hdr .badge{display:inline-block;background:rgba(255,255,255,.18);padding:3px 12px;border-radius:20px;font-size:10px;margin-top:8px;letter-spacing:.3px}
.steps-bar{display:flex;gap:2px;margin-bottom:20px;background:var(--card);padding:6px;border-radius:10px;border:1px solid var(--border);overflow-x:auto}
.step-tab{flex:1;text-align:center;padding:8px 4px;border-radius:7px;font-size:11px;font-weight:500;color:var(--text3);cursor:pointer;transition:.2s;white-space:nowrap;border:none;background:none;font-family:inherit}
.step-tab.active{background:var(--kaigo);color:#fff}
.step-tab.done{color:var(--kaigo);font-weight:600}
.step-tab:hover:not(.active){background:var(--bg)}
.sec{display:none}.sec.active{display:block}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin-bottom:14px;box-shadow:var(--shadow)}
.card h2{font-size:15px;font-weight:700;margin-bottom:10px;padding-bottom:6px;border-bottom:2px solid var(--border);display:flex;align-items:center;gap:6px}
.card h3{font-size:13px;font-weight:600;margin:10px 0 6px;color:var(--text)}
.notice{padding:10px 14px;border-radius:8px;font-size:12px;line-height:1.6;margin-bottom:12px}
.notice.warn{background:var(--warn-light);border-left:3px solid var(--warn);color:var(--warn-text)}
.notice.info{background:var(--kaigo-light);border-left:3px solid var(--kaigo);color:#065F46}
.notice.info-s{background:var(--shogai-light);border-left:3px solid var(--shogai);color:#1E40AF}
.notice.danger{background:var(--danger-light);border-left:3px solid var(--danger);color:#991B1B}
.notice.purple{background:var(--purple-light);border-left:3px solid var(--purple);color:#5B21B6}
.fg{margin-bottom:12px}
.fg label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:3px}
.fg .help{font-size:11px;color:var(--text3);margin-top:2px;line-height:1.5}
.fg input[type=number],.fg input[type=text],.fg select{width:100%;padding:8px 12px;border:1px solid var(--border2);border-radius:8px;font-size:14px;font-family:inherit;background:#fff;transition:.15s}
.fg input:focus,.fg select:focus{outline:none;border-color:var(--kaigo);box-shadow:0 0 0 3px rgba(10,107,94,.1)}
.opt-group{display:flex;flex-direction:column;gap:6px;margin:8px 0}
.opt-item{display:flex;align-items:flex-start;gap:8px;padding:10px 12px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:.15s;font-size:13px;line-height:1.5}
.opt-item:hover{background:var(--bg)}
.opt-item input{margin-top:3px;accent-color:var(--kaigo)}
.svc-cat{margin-bottom:12px}
.svc-cat-title{font-size:12px;font-weight:600;color:var(--text2);padding:6px 0;border-bottom:1px solid var(--border);margin-bottom:6px}
.svc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:4px}
.svc-item{display:flex;align-items:center;gap:6px;padding:7px 10px;border:1px solid var(--border);border-radius:6px;cursor:pointer;font-size:12px;transition:.12s}
.svc-item:hover{background:var(--bg)}
.svc-item input{accent-color:var(--kaigo)}
.rev-row{display:grid;grid-template-columns:1fr 110px;gap:8px;align-items:end;padding:8px 0;border-bottom:1px solid var(--border)}
.rev-row:last-child{border-bottom:none}
.rev-row .rn{font-size:12px;font-weight:500}
.rev-row .rr{font-size:10px;color:var(--text3)}
.rev-row input{padding:6px 10px;border:1px solid var(--border2);border-radius:6px;font-size:13px;text-align:right;font-family:inherit;width:100%}
.results{background:linear-gradient(135deg,#F0FDF4 0%,#ECFDF5 100%);border:2px solid var(--success);border-radius:var(--radius);padding:18px;margin:14px 0}
.result-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:10px}
.r-card{background:#fff;border-radius:8px;padding:12px;text-align:center;box-shadow:var(--shadow)}
.r-card .rl{font-size:10px;color:var(--text3);margin-bottom:3px}
.r-card .rv{font-size:22px;font-weight:900;color:var(--kaigo)}
.r-card .ru{font-size:10px;color:var(--text2)}
.r-card.main{border:2px solid var(--kaigo)}
.acc{border:1px solid var(--border);border-radius:8px;margin-bottom:6px;overflow:hidden}
.acc-h{padding:10px 14px;background:var(--bg);cursor:pointer;font-size:12px;font-weight:600;display:flex;justify-content:space-between;align-items:center;user-select:none}
.acc-h:hover{background:var(--border)}
.acc-h .arr{transition:.3s;font-size:14px}
.acc-h.open .arr{transform:rotate(180deg)}
.acc-b{padding:0 14px;max-height:0;overflow:hidden;transition:max-height .3s}
.acc-b.open{max-height:5000px;padding:10px 14px}
.todo-item{display:flex;align-items:flex-start;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.todo-item:last-child{border-bottom:none}
.todo-item input[type=checkbox]{margin-top:3px;accent-color:var(--kaigo);width:16px;height:16px;flex-shrink:0}
.todo-item.done{opacity:.5;text-decoration:line-through}
.todo-phase{font-size:12px;font-weight:700;color:var(--kaigo);padding:8px 0 4px;border-bottom:2px solid var(--kaigo)}
.faq-item{border-bottom:1px solid var(--border);padding:10px 0}
.faq-q{font-size:13px;font-weight:600;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.faq-a{font-size:12px;color:var(--text2);max-height:0;overflow:hidden;transition:max-height .3s;line-height:1.7}
.faq-a.open{max-height:500px;padding-top:6px}
.tpl-box{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;font-size:12px;white-space:pre-wrap;line-height:1.8;position:relative}
.copy-btn{position:absolute;top:8px;right:8px;padding:4px 10px;background:var(--kaigo);color:#fff;border:none;border-radius:4px;font-size:10px;cursor:pointer;font-family:inherit}
.btn-primary{width:100%;padding:13px;background:var(--kaigo);color:#fff;border:none;border-radius:var(--radius);font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;box-shadow:var(--shadow2);transition:.15s}
.btn-primary:hover{transform:translateY(-1px)}
.btn-secondary{padding:8px 16px;background:#fff;border:1px solid var(--border2);border-radius:8px;font-size:12px;cursor:pointer;font-family:inherit;transition:.15s}
.btn-secondary:hover{background:var(--bg)}
.btn-print{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;background:#fff;border:2px solid var(--kaigo);border-radius:8px;font-size:13px;font-weight:600;color:var(--kaigo);cursor:pointer;font-family:inherit;transition:.15s;margin:12px 0}
.btn-print:hover{background:var(--kaigo-light)}
.btn-row{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap}
.nav-row{display:flex;justify-content:space-between;margin-top:16px;padding-top:12px;border-top:1px solid var(--border)}
.nav-btn{padding:10px 24px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;border:none;transition:.15s}
.nav-prev{background:var(--bg);color:var(--text2);border:1px solid var(--border2)}
.nav-next{background:var(--kaigo);color:#fff}
.nav-btn:hover{transform:translateY(-1px)}
.cmp{width:100%;border-collapse:collapse;font-size:11px;margin-top:8px}
.cmp th,.cmp td{padding:7px 8px;border:1px solid var(--border);text-align:left;vertical-align:top}
.cmp th{background:var(--bg);font-weight:600;white-space:nowrap}
.footer{text-align:center;padding:20px 12px;font-size:10px;color:var(--text3);line-height:1.6}
.footer a{color:var(--text3)}
/* Office group card */
.office-card{background:var(--card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:14px}
.office-card h3{font-size:14px;font-weight:700;color:var(--kaigo);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.office-card .office-svcs{font-size:11px;color:var(--text3);margin-bottom:10px}
.office-card .office-total{font-size:13px;font-weight:700;color:var(--kaigo);padding:8px;background:var(--kaigo-light);border-radius:6px;text-align:center;margin:8px 0}
.dist-box{background:#f8f9fa;border:1px solid var(--border);border-radius:8px;padding:14px;margin:8px 0}
.dist-result{background:#fff;border:1px solid var(--border);border-radius:8px;padding:12px;margin-top:8px;font-size:12px}
.dist-result table{width:100%;border-collapse:collapse}
.dist-result td{padding:4px 8px;border-bottom:1px solid var(--border)}
.dist-result .dr-total{font-weight:900;font-size:16px;color:var(--kaigo)}
/* Grouping UI */
.grp-row{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.grp-row select{padding:4px 8px;border:1px solid var(--border2);border-radius:6px;font-size:12px;font-family:inherit}
/* Print */
@media print{
  body{background:#fff;font-size:11px}
  .hdr,.steps-bar,.nav-row,.btn-row,.btn-primary,.btn-secondary,.btn-print,.copy-btn,.footer,.no-print{display:none!important}
  .sec{display:none!important}
  .print-target{display:block!important}
  .print-target .card,.print-target .office-card{box-shadow:none;border:1px solid #ccc;break-inside:avoid}
  .wrap{max-width:100%;padding:0}
  .print-hdr{display:block!important;text-align:center;border-bottom:2px solid #333;padding-bottom:8px;margin-bottom:16px}
  .print-hdr h1{font-size:16px;color:#333}
  .print-hdr p{font-size:10px;color:#666}
}
.print-hdr{display:none}
@media(max-width:600px){
  .wrap{padding:6px}
  .hdr h1{font-size:17px}
  .result-grid{grid-template-columns:1fr 1fr}
  .svc-grid{grid-template-columns:1fr}
  .rev-row{grid-template-columns:1fr 90px}
  .step-tab{font-size:9px;padding:6px 2px}
  .grp-row{flex-direction:column;align-items:flex-start;gap:4px}
}
</style>
</head>
<body>

<div class="hdr">
  <h1>å‡¦é‡æ”¹å–„ è³ƒä¸Šã’è£œåŠ©é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
  <div class="sub">ä»¤å’Œ7å¹´åº¦è£œæ­£äºˆç®—ã€ŒåŒ»ç™‚ãƒ»ä»‹è­·ç­‰æ”¯æ´ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€å¯¾å¿œ</div>
  <div class="badge">TRINITY PARTNERS â”€ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé…å¸ƒç”¨ v4</div>
</div>

<div class="wrap">

<div class="steps-bar" id="stepsBar">
  <button class="step-tab active" onclick="goStep(0)">STEP 0<br>è¨ºæ–­</button>
  <button class="step-tab" onclick="goStep(1)">STEP 1<br>å ±é…¬å…¥åŠ›</button>
  <button class="step-tab" onclick="goStep(2)">STEP 2<br>è¦ä»¶</button>
  <button class="step-tab" onclick="goStep(3)">STEP 3<br>çµæœ</button>
  <button class="step-tab" onclick="goStep(4)">STEP 4<br>é…åˆ†</button>
  <button class="step-tab" onclick="goStep(5)">STEP 5<br>ToDo</button>
  <button class="step-tab" onclick="goStep(6)">å·»æœ«<br>FAQ</button>
</div>

<!-- ==================== STEP 0 ==================== -->
<div class="sec active" id="sec0">
<div class="card">
  <h2>ğŸ“‹ ã¾ãšã¯3ã¤ã®è³ªå•</h2>
  <p style="font-size:12px;color:var(--text2);margin-bottom:12px">ã‚ãªãŸã«é–¢ä¿‚ã®ã‚ã‚‹æƒ…å ±ã ã‘ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>

  <div class="fg">
    <label>Q1. é‹å–¶ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ†é‡ã¯ï¼Ÿ</label>
    <div class="opt-group">
      <label class="opt-item"><input type="radio" name="q1" value="kaigo" onchange="selectQ1()"> ä»‹è­·ä¿é™ºã‚µãƒ¼ãƒ“ã‚¹ã®ã¿</label>
      <label class="opt-item"><input type="radio" name="q1" value="shogai" onchange="selectQ1()"> éšœå®³ç¦ç¥‰ã‚µãƒ¼ãƒ“ã‚¹ã®ã¿</label>
      <label class="opt-item"><input type="radio" name="q1" value="both" onchange="selectQ1()"> ä¸¡æ–¹ã‚ã‚‹</label>
    </div>
  </div>

  <!-- Q2: kaigo -->
  <div id="q2kaigo" style="display:none">
    <div class="fg">
      <label>Q2. æä¾›ã—ã¦ã„ã‚‹ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠ</label>

      <!-- ä½å®…å‹ãƒã‚§ãƒƒã‚¯ï¼šã‚µãƒ¼ãƒ“ã‚¹é¸æŠã¨ã¯ç‹¬ç«‹ -->
      <div style="margin-bottom:12px;padding:10px 14px;background:var(--warn-light);border:1px solid var(--warn);border-radius:8px">
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer">
          <input type="checkbox" id="jutakugata" onchange="toggleJutaku()" style="accent-color:var(--warn);width:16px;height:16px">
          <span>ä½å®…å‹æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ã‚’é‹å–¶ã—ã¦ã„ã‚‹</span>
        </label>
        <div id="jutakuNotice" style="display:none;margin-top:8px;font-size:12px;color:var(--warn-text);line-height:1.6">
          ğŸ“Œ ä½å®…å‹æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ã®å»ºç‰©ãƒ»å±…ä½éƒ¨åˆ†ã¯<strong>å¯¾è±¡å¤–</strong>ã§ã™ã€‚<br>
          ãŸã ã—ã€å…¥å±…è€…ã«æä¾›ã—ã¦ã„ã‚‹ã€Œè¨ªå•ä»‹è­·ã€ã€Œè¨ªå•çœ‹è­·ã€ç­‰ã¯å¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚<br>
          â†’ ä¸‹ã®ãƒªã‚¹ãƒˆã‹ã‚‰å®Ÿéš›ã«æä¾›ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚<br>
          <small>â€» ç‰¹å®šæ–½è¨­å…¥å±…è€…ç”Ÿæ´»ä»‹è­·ã®æŒ‡å®šã‚’å—ã‘ã¦ã„ã‚‹å ´åˆã¯ã€å…¥æ‰€ãƒ»æ–½è¨­ç³»ã€‘ã«è©²å½“ã—ã¾ã™ã€‚</small>
        </div>
      </div>

      <div class="svc-cat"><div class="svc-cat-title">ğŸ  è¨ªå•ç³»</div><div class="svc-grid" id="cat_houmon"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">â˜€ï¸ é€šæ‰€ç³»</div><div class="svc-grid" id="cat_tsusho"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">ğŸ¥ å…¥æ‰€ãƒ»æ–½è¨­ç³»</div><div class="svc-grid" id="cat_shisetsu"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">ğŸ”„ å¤šæ©Ÿèƒ½ç³»</div><div class="svc-grid" id="cat_taki"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">ğŸ“‹ ã‚±ã‚¢ãƒãƒãƒ»ãã®ä»–</div><div class="svc-grid" id="cat_other"></div></div>
    </div>
  </div>

  <!-- Q2b: shogai -->
  <div id="q2shogai" style="display:none">
    <div class="fg">
      <label>Q2b. æä¾›ã—ã¦ã„ã‚‹éšœå®³ç¦ç¥‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠ</label>
      <div class="svc-cat"><div class="svc-cat-title">ğŸ  è¨ªå•ç³»</div><div class="svc-grid" id="scat_houmon"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">â˜€ï¸ æ—¥ä¸­æ´»å‹•ç³»</div><div class="svc-grid" id="scat_nicchu"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">ğŸ˜ï¸ å±…ä½ç³»</div><div class="svc-grid" id="scat_kyoju"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">ğŸ‘¶ éšœå®³å…</div><div class="svc-grid" id="scat_jidou"></div></div>
      <div class="svc-cat"><div class="svc-cat-title">ğŸ“‹ ãã®ä»–</div><div class="svc-grid" id="scat_sonota"></div></div>
    </div>
  </div>

  <!-- Q2c: Office grouping -->
  <div id="q2c" style="display:none">
    <div class="fg">
      <label>Q2c. åŒã˜äº‹æ¥­æ‰€ï¼ˆåŒã˜å ´æ‰€ãƒ»åŒã˜ã‚¹ã‚¿ãƒƒãƒ•ï¼‰ã§æä¾›ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</label>
      <div class="notice info" style="margin-top:6px">
        ğŸ“Œ è£œåŠ©é‡‘ã¯äº‹æ¥­æ‰€ã”ã¨ã«é…åˆ†ã‚’è¨­è¨ˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆäº‹æ¥­æ‰€é–“ã®èé€šã¯ä¸å¯ï¼‰ã€‚<br>
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å…¨ã¦åŒä¸€äº‹æ¥­æ‰€ï¼ˆAï¼‰ã§ã™ã€‚ç•°ãªã‚‹äº‹æ¥­æ‰€ã§æä¾›ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€Œäº‹æ¥­æ‰€Bã€ã€Œäº‹æ¥­æ‰€Cã€ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
      </div>
      <div id="grpList"></div>
      <div id="grpNames" style="margin-top:10px"></div>
      <div class="notice" style="background:#f8f9fa;border-left:3px solid var(--text3);color:var(--text2);margin-top:8px">
        ğŸ’¡ ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šè¨ªå•ä»‹è­·ï¼‹å±…å®…ä»‹è­·ï¼‹é‡åº¦è¨ªå•ä»‹è­·ï¼ˆåŒä¸€äº‹æ¥­æ‰€ï¼‰ï¼ è¨ªå•çœ‹è­·ï¼ˆåˆ¥äº‹æ¥­æ‰€ï¼‰ï¼ é€šæ‰€ä»‹è­·ï¼‹ç”Ÿæ´»ä»‹è­·ï¼ˆåŒä¸€å»ºç‰©ä½µè¨­ï¼‰
      </div>
    </div>
  </div>

  <!-- Q3 -->
  <div id="q3area" style="display:none">
    <div class="fg">
      <label>Q3. å‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šçŠ¶æ³ã¯ï¼Ÿ</label>

      <!-- ä»‹è­·åˆ† -->
      <div id="q3kArea" style="display:none">
        <h3 style="font-size:12px;margin:8px 0 4px">ğŸ¥ ä»‹è­·ä¿é™ºã‚µãƒ¼ãƒ“ã‚¹</h3>
        <div class="opt-group">
          <label class="opt-item"><input type="radio" name="q3k" value="yes" checked onchange="updQ3()"> ç®—å®šä¸­ï¼ˆåŠ ç®—â… ã€œâ…£ã®ã„ãšã‚Œã‹ï¼‰</label>
          <label class="opt-item"><input type="radio" name="q3k" value="maybe" onchange="updQ3()"> ãŸã¶ã‚“ç®—å®šã—ã¦ã„ã‚‹ãŒç¢ºèªãŒå¿…è¦</label>
          <label class="opt-item"><input type="radio" name="q3k" value="no" onchange="updQ3()"> ç®—å®šã—ã¦ã„ãªã„</label>
        </div>
      </div>

      <!-- éšœå®³åˆ† -->
      <div id="q3sArea" style="display:none">
        <h3 style="font-size:12px;margin:8px 0 4px">â™¿ éšœå®³ç¦ç¥‰ã‚µãƒ¼ãƒ“ã‚¹</h3>
        <div class="opt-group">
          <label class="opt-item"><input type="radio" name="q3s" value="yes" checked onchange="updQ3()"> ç®—å®šä¸­ï¼ˆç¦ç¥‰ãƒ»ä»‹è­·è·å“¡å‡¦é‡æ”¹å–„åŠ ç®—â… ã€œâ…£ï¼‰</label>
          <label class="opt-item"><input type="radio" name="q3s" value="maybe" onchange="updQ3()"> ãŸã¶ã‚“ç®—å®šã—ã¦ã„ã‚‹ãŒç¢ºèªãŒå¿…è¦</label>
          <label class="opt-item"><input type="radio" name="q3s" value="no" onchange="updQ3()"> ç®—å®šã—ã¦ã„ãªã„</label>
        </div>
      </div>

      <div id="q3maybe" style="display:none" class="notice info">
        ğŸ’¡ <strong>ç¢ºèªæ–¹æ³•ï¼š</strong>æ¯æœˆã®å ±é…¬è«‹æ±‚ã§ã€Œå‡¦é‡æ”¹å–„åŠ ç®—ã€ã®å˜ä½æ•°ãŒè¨ˆä¸Šã•ã‚Œã¦ã„ã‚Œã°ç®—å®šä¸­ã§ã™ã€‚è«‹æ±‚ã‚½ãƒ•ãƒˆã®ã€ŒåŠ ç®—ä¸€è¦§ã€ã¾ãŸã¯ã€Œä½“åˆ¶å±Šå‡ºçŠ¶æ³ã€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚ä¸æ˜ãªå ´åˆã¯æ‹…å½“ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
      </div>
    </div>
  </div>
</div>

<div id="step0nav" style="display:none" class="nav-row">
  <div></div>
  <button class="nav-btn nav-next" onclick="goStep(1)">æ¬¡ã¸ â†’ å ±é…¬å…¥åŠ›</button>
</div>
</div>

<!-- ==================== STEP 1 ==================== -->
<div class="sec" id="sec1">
<div class="acc">
  <div class="acc-h open" onclick="toggleAcc(this)">
    <span>ğŸ“Œ å…¥åŠ›ã™ã‚‹é‡‘é¡ã«ã¤ã„ã¦ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</span><span class="arr">â–¼</span>
  </div>
  <div class="acc-b open" style="font-size:12px;color:var(--text2);line-height:1.8">
    <strong>â–  ä½•æœˆåˆ†ã®æ•°å­—ï¼Ÿ</strong><br>
    ã€ä»‹è­·ã€‘åŸå‰‡ â†’ <strong>ä»¤å’Œ7å¹´ï¼ˆ2025å¹´ï¼‰12æœˆ</strong>ã®ã‚µãƒ¼ãƒ“ã‚¹æä¾›åˆ†<br>
    ã€éšœå®³ç¦ç¥‰ã€‘åŸå‰‡ â†’ <strong>ä»¤å’Œ7å¹´ï¼ˆ2025å¹´ï¼‰12æœˆ</strong>ã®ã‚µãƒ¼ãƒ“ã‚¹æä¾›åˆ†<br>
    <small>â€» å›½ä¿é€£ã¸ã®è«‹æ±‚ã¯ç¿Œæœˆ10æ—¥ã§ã™ã€‚ã€ŒR8å¹´1æœˆè«‹æ±‚åˆ†ã€ï¼ã€ŒR7å¹´12æœˆæä¾›åˆ†ã€</small><br><br>
    <strong>â–  ã¾ã åŸºæº–æœˆãŒæ¥ã¦ã„ãªã„å ´åˆ</strong><br>
    ç›´è¿‘ã®é€šå¸¸æœˆã®å ±é…¬é¡ï¼ˆä¾‹ï¼šR7å¹´10æœˆã‚„11æœˆåˆ†ï¼‰ã‚’å…¥åŠ›ã™ã‚Œã°æ¦‚ç®—ãŒå‡ºã¾ã™ã€‚<br><br>
    <strong>â–  ã©ã®æ•°å­—ã‚’å…¥åŠ›ã™ã‚‹ï¼Ÿ</strong><br>
    ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã®ã€Œä»‹è­·å ±é…¬ç·é¡ã€ï¼ ç·å˜ä½æ•°ï¼ˆåŸºæœ¬å ±é…¬ï¼‹å„ç¨®åŠ ç®—æ¸›ç®—ï¼‰Ã— åœ°åŸŸå˜ä¾¡<br>
    â€» å‡¦é‡æ”¹å–„åŠ ç®—ã‚’<strong>å«ã‚ãŸ</strong>é‡‘é¡ ï¼ åˆ©ç”¨è€…è² æ‹…åˆ†ã‚’å¼•ã<strong>å‰</strong>ã®è«‹æ±‚ç·é¡<br><br>
    <strong>â–  ç¢ºèªå ´æ‰€</strong><br>
    ãƒ»å›½ä¿é€£ã€Œä»‹è­·çµ¦ä»˜è²»ç­‰æ”¯æ‰•æ±ºå®šé¡é€šçŸ¥æ›¸ã€â†’ ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ã€Œè«‹æ±‚é¡ã€<br>
    ãƒ»è«‹æ±‚ã‚½ãƒ•ãƒˆã®æœˆæ¬¡é›†è¨ˆ â†’ ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ç·å˜ä½æ•° Ã— åœ°åŸŸå˜ä¾¡<br><br>
    <strong>â–  ã©ã†ã—ã¦ã‚‚ã‚ã‹ã‚‰ãªã„å ´åˆ</strong><br>
    å›½ä¿é€£ã‹ã‚‰ã®æŒ¯è¾¼é¡ Ã· ã‚µãƒ¼ãƒ“ã‚¹æ•° ã§æŒ‰åˆ†ã—ãŸæ¦‚ç®—ã§ã‚‚OKã§ã™ã€‚<br>
    æ­£ç¢ºãªæ•°å­—ã¯æ‹…å½“ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆãŒãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚
  </div>
</div>

<div class="card">
  <h2>ğŸ“Š åŸºæº–æœˆã®é¸æŠ</h2>
  <div class="fg">
    <select id="baseMonth" onchange="updateBaseLabel()">
      <option value="12" selected>12æœˆåˆ†ï¼ˆåŸå‰‡ï¼‰</option>
      <option value="1">1æœˆåˆ†</option>
      <option value="2">2æœˆåˆ†</option>
      <option value="3">3æœˆåˆ†</option>
      <option value="est">ã¾ã ç¢ºå®šå‰ï¼ˆç›´è¿‘æœˆã§æ¦‚ç®—ï¼‰</option>
    </select>
    <div class="help">âš ï¸ 12æœˆä»¥å¤–ã‚’é¸æŠã™ã‚‹å ´åˆã¯ã€Œ12æœˆãŒè‘—ã—ãä½ã„ã€ã“ã¨ãŒæ¡ä»¶ã§ã™ã€‚</div>
  </div>
</div>

<div class="card" id="kaigoRevCard" style="display:none">
  <h2>ğŸ¥ ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹ã® <span id="kBaseLabel">R7å¹´12æœˆåˆ†</span> å ±é…¬é¡</h2>
  <div id="kaigoRevRows"></div>
</div>

<div class="card" id="shogaiRevCard" style="display:none">
  <h2>â™¿ éšœå®³ç¦ç¥‰ã‚µãƒ¼ãƒ“ã‚¹ã® <span id="sBaseLabel">R7å¹´12æœˆåˆ†</span> å ±é…¬é¡</h2>
  <div id="shogaiRevRows"></div>
</div>

<div class="nav-row">
  <button class="nav-btn nav-prev" onclick="goStep(0)">â† æˆ»ã‚‹</button>
  <button class="nav-btn nav-next" onclick="goStep(2)">æ¬¡ã¸ â†’ è¦ä»¶ãƒã‚§ãƒƒã‚¯</button>
</div>
</div>

<!-- ==================== STEP 2 ==================== -->
<div class="sec" id="sec2">
<div class="card" id="kaigoReqCard" style="display:none">
  <h2>ğŸ¥ ä»‹è­·åˆ†é‡ã®è¦ä»¶</h2>
  <div id="kaigoReqRows"></div>
</div>

<div class="card" id="shogaiReqCard" style="display:none">
  <h2>â™¿ éšœå®³ç¦ç¥‰åˆ†é‡ã®è¦ä»¶</h2>
  <div class="fg">
    <label>è·å ´ç’°å¢ƒæ”¹å–„ã®å–çµ„</label>
    <select id="s_env"><option value="yes">å®Ÿæ–½æ¸ˆã¿ or è¨ˆç”»ä¸­</option><option value="no">æœªå®Ÿæ–½</option></select>
    <div class="help">ä»‹è­·åˆ†é‡ã¨åŒã˜3é …ç›®ã®ã„ãšã‚Œã‹ã€‚å…¨é¡ã‚’è³ƒé‡‘æ”¹å–„ã«ä½¿ç”¨ã€‚</div>
  </div>
</div>

<div class="card">
  <h2>ğŸ‘¥ äº‹æ¥­æ‰€ã”ã¨ã®è·å“¡æ•°</h2>
  <div class="notice info">
    ğŸ“Œ è£œåŠ©é‡‘ã¯äº‹æ¥­æ‰€ã”ã¨ã«é…åˆ†ã‚’è¨­è¨ˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€äº‹æ¥­æ‰€å˜ä½ã§è·å“¡æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
    ğŸ’¡ å…¼å‹™è·å“¡ã¯ä¸»ãŸã‚‹å‹¤å‹™å…ˆã§ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ãã ã•ã„ã€‚
  </div>
  <div id="staffInputArea"></div>
</div>

<div class="nav-row">
  <button class="nav-btn nav-prev" onclick="goStep(1)">â† æˆ»ã‚‹</button>
  <button class="nav-btn nav-next" onclick="goStep(3)">æ¬¡ã¸ â†’ çµæœã‚’è¦‹ã‚‹</button>
</div>
</div>

<!-- ==================== STEP 3 ==================== -->
<div class="sec" id="sec3">
<div id="resultArea"></div>

<div class="nav-row">
  <button class="nav-btn nav-prev" onclick="goStep(2)">â† æˆ»ã‚‹</button>
  <button class="nav-btn nav-next" onclick="goStep(4)">æ¬¡ã¸ â†’ é…åˆ†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
</div>
</div>

<!-- ==================== STEP 4 ==================== -->
<div class="sec" id="sec4">
<div class="card">
  <h2>ğŸ’´ é…åˆ†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
  <div class="notice warn">âš ï¸ é…åˆ†ã¯äº‹æ¥­æ‰€ã”ã¨ã«è¨­è¨ˆã—ã¦ãã ã•ã„ã€‚äº‹æ¥­æ‰€é–“ã§ã®èé€šã¯å®Ÿæ–½è¦ç¶±ã§ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚</div>
</div>
<div id="distArea"></div>
<div id="distSummary"></div>

<div style="text-align:center;margin-top:16px">
  <button class="btn-print" onclick="printSection('result')">ğŸ–¨ï¸ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã‚’å°åˆ·</button>
</div>

<div class="nav-row">
  <button class="nav-btn nav-prev" onclick="goStep(3)">â† æˆ»ã‚‹</button>
  <button class="nav-btn nav-next" onclick="goStep(5)">æ¬¡ã¸ â†’ ToDo</button>
</div>
</div>

<!-- ==================== STEP 5 ==================== -->
<div class="sec" id="sec5">
<div class="card">
  <h2>âœ… ã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆ</h2>
  <p style="font-size:12px;color:var(--text2);margin-bottom:8px">ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚ŒãªãŒã‚‰é€²ã‚ã¦ãã ã•ã„ã€‚ã‚ãªãŸã®é¸æŠã«å¿œã˜ãŸé …ç›®ã ã‘è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
  <div class="fg">
    <label>ç”³è«‹ãƒ‘ã‚¿ãƒ¼ãƒ³</label>
    <div class="opt-group" style="flex-direction:row;gap:12px">
      <label class="opt-item" style="flex:1"><input type="radio" name="todoPat" value="A" checked onchange="buildTodo()"> Aãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ2æœˆç”³è«‹â†’4æœˆæ”¯çµ¦ï¼‰</label>
      <label class="opt-item" style="flex:1"><input type="radio" name="todoPat" value="B" onchange="buildTodo()"> Bãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ4æœˆç”³è«‹â†’6æœˆæ”¯çµ¦ï¼‰</label>
    </div>
  </div>
  <div class="notice" style="background:#f8f9fa;border-left:3px solid var(--text3);color:var(--text2);font-size:11px">
    â€» æ„›çŸ¥çœŒãŒæå‡ºå…ˆã§ã™ã€‚åå¤å±‹å¸‚ã¯æŒ‡å®šæ¨©è€…ãŒå¸‚ã®ãŸã‚æå‡ºå…ˆãŒç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä»–çœŒã®å ´åˆã¯å„éƒ½é“åºœçœŒã«ã”ç¢ºèªãã ã•ã„ã€‚
  </div>
</div>
<div id="todoArea"></div>

<div style="text-align:center;margin-top:16px">
  <button class="btn-print" onclick="printSection('todo')">ğŸ–¨ï¸ ToDoãƒªã‚¹ãƒˆã‚’å°åˆ·</button>
</div>

<div class="nav-row">
  <button class="nav-btn nav-prev" onclick="goStep(4)">â† æˆ»ã‚‹</button>
  <button class="nav-btn nav-next" onclick="goStep(6)">æ¬¡ã¸ â†’ FAQ</button>
</div>
</div>

<!-- ==================== STEP 6 ==================== -->
<div class="sec" id="sec6">
<div class="card">
  <h2>â“ ã‚ˆãã‚ã‚‹è³ªå•</h2>
  <div id="faqArea"></div>
</div>

<div class="card">
  <h2>ğŸ“ è·å“¡ã¸ã®èª¬æ˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2>
  <div class="fg">
    <select id="tplType" onchange="showTpl()">
      <option value="lump">ä¸€æ™‚é‡‘å‹</option>
      <option value="monthly">æœˆé¡æ‰‹å½“å‹</option>
    </select>
  </div>
  <div id="tplArea"></div>
</div>

<div class="card">
  <h2>âš–ï¸ ä»‹è­· vs éšœå®³ç¦ç¥‰ æ¯”è¼ƒè¡¨</h2>
  <div style="overflow-x:auto">
  <table class="cmp">
    <tr><th style="width:120px">é …ç›®</th><th style="background:var(--kaigo-light)">ğŸ¥ ä»‹è­·</th><th style="background:var(--shogai-light)">â™¿ éšœå®³ç¦ç¥‰</th></tr>
    <tr><td><strong>è£œåŠ©é‡‘åŒºåˆ†</strong></td><td>3æ®µéšï¼ˆâ‘ è³ƒä¸Šã’ï¼‹â‘¡å”åƒåŒ–ï¼‹â‘¢è·å ´ç’°å¢ƒæ”¹å–„ï¼‰</td><td>1æ®µéšã®ã¿</td></tr>
    <tr><td><strong>1äººã‚ãŸã‚Šç›®å®‰</strong></td><td>æœ€å¤§ æœˆ1.9ä¸‡å††Ã—6ãƒ¶æœˆ</td><td>æœˆç´„1ä¸‡å††Ã—6ãƒ¶æœˆ</td></tr>
    <tr><td><strong>åŸºæº–æœˆ</strong></td><td>åŸå‰‡ R7å¹´12æœˆ</td><td>åŸå‰‡ R7å¹´12æœˆ</td></tr>
    <tr><td><strong>ç”¨é€”</strong></td><td>â‘ â‘¡â†’è³ƒé‡‘ / â‘¢â†’ç’°å¢ƒæ”¹å–„ or è³ƒé‡‘</td><td><strong>å…¨é¡è³ƒé‡‘ã®ã¿</strong></td></tr>
    <tr><td><strong>å¯¾è±¡å¤–</strong></td><td>å±…å®…ç™‚é¤Šç®¡ç†æŒ‡å°ã€ç¦ç¥‰ç”¨å…·</td><td>è¨ˆç”»ç›¸è«‡ã€éšœå®³å…ç›¸è«‡ã€åœ°åŸŸç›¸è«‡</td></tr>
    <tr><td><strong>ä½å®…å‹æœ‰è€</strong></td><td>ãƒã‚³ã¯å¯¾è±¡å¤–ã€ä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯å¯¾è±¡</td><td>â”€</td></tr>
    <tr><td><strong>äº‹æ¥­æ‰€é–“èé€š</strong></td><td colspan="2">ä¸å¯ï¼ˆã€Œè‘—ã—ãåã£ãŸé…åˆ†ã€ã¨ã—ã¦ç¦æ­¢ã€‚Vol.1454 7(1)â‘ ï¼‰</td></tr>
  </table>
  </div>
</div>

<div style="text-align:center;margin-top:16px">
  <button class="btn-print" onclick="printSection('faq')">ğŸ–¨ï¸ FAQãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å°åˆ·</button>
</div>

<div class="nav-row">
  <button class="nav-btn nav-prev" onclick="goStep(5)">â† æˆ»ã‚‹</button>
  <div></div>
</div>
</div>

<!-- Print target containers -->
<div id="printResult" class="sec"></div>
<div id="printTodo" class="sec"></div>
<div id="printFaq" class="sec"></div>

<!-- Footer -->
<div class="footer">
  <strong>TRINITY PARTNERS</strong> â”€ å‡¦é‡æ”¹å–„è³ƒä¸Šã’è£œåŠ©é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v4<br>
  æœ¬ãƒ„ãƒ¼ãƒ«ã¯æ¦‚ç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã§ã™ã€‚æ­£å¼ãªäº¤ä»˜ç‡ã¯<a href="https://www.mhlw.go.jp/content/001623447.pdf" target="_blank">åšåŠ´çœVol.1454</a>ã‚’ã”ç¢ºèªãã ã•ã„ã€‚<br>
  æœ€çµ‚æ›´æ–°ï¼š2026/02/08
</div>

</div><!-- /wrap -->

<script>
// ===== DATA =====
const K_SVC={
  houmon_kaigo:{n:'è¨ªå•ä»‹è­·ï¼ˆãƒ›ãƒ¼ãƒ ãƒ˜ãƒ«ãƒ—ï¼‰',cat:'houmon',t:1,r1:.156,r2:.060,r3:.048},
  yakan_houmon:{n:'å¤œé–“å¯¾å¿œå‹è¨ªå•ä»‹è­·',cat:'houmon',t:1,r1:.132,r2:.042,r3:.030},
  teiki_houmon:{n:'å®šæœŸå·¡å›ãƒ»éšæ™‚å¯¾å¿œå‹',cat:'houmon',t:1,r1:.132,r2:.042,r3:.030},
  houmon_nyuyoku:{n:'è¨ªå•å…¥æµ´ä»‹è­·',cat:'houmon',t:1,r1:.132,r2:.042,r3:.030},
  tsusho_kaigo:{n:'é€šæ‰€ä»‹è­·ï¼ˆãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ï¼‰',cat:'tsusho',t:1,r1:.126,r2:.036,r3:.030},
  chiiki_tsusho:{n:'åœ°åŸŸå¯†ç€å‹é€šæ‰€ä»‹è­·ï¼ˆå°è¦æ¨¡ãƒ‡ã‚¤ï¼‰',cat:'tsusho',t:1,r1:.168,r2:.042,r3:.036},
  tsusho_riha:{n:'é€šæ‰€ãƒªãƒãƒ“ãƒªï¼ˆãƒ‡ã‚¤ã‚±ã‚¢ï¼‰',cat:'tsusho',t:1,r1:.114,r2:.030,r3:.024},
  ninchi_tsusho:{n:'èªçŸ¥ç—‡å¯¾å¿œå‹ãƒ‡ã‚¤',cat:'tsusho',t:1,r1:.216,r2:.072,r3:.060},
  tokutei:{n:'ç‰¹å®šæ–½è¨­ï¼ˆä»‹è­·ä»˜ãæœ‰è€ç­‰ï¼‰',cat:'shisetsu',t:2,r1:.132,r2:.042,r3:.036},
  chiiki_tokutei:{n:'åœ°åŸŸå¯†ç€å‹ç‰¹å®šæ–½è¨­',cat:'shisetsu',t:2,r1:.132,r2:.042,r3:.036},
  ninchi_gh:{n:'èªçŸ¥ç—‡GH',cat:'shisetsu',t:2,r1:.150,r2:.066,r3:.054},
  kaigo_fukushi:{n:'ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ ï¼ˆç‰¹é¤Šï¼‰',cat:'shisetsu',t:2,r1:.144,r2:.048,r3:.042},
  chiiki_tokuyo:{n:'åœ°åŸŸå¯†ç€å‹ç‰¹é¤Š',cat:'shisetsu',t:2,r1:.144,r2:.048,r3:.042},
  tanki_seikatsu:{n:'ã‚·ãƒ§ãƒ¼ãƒˆã‚¹ãƒ†ã‚¤ï¼ˆç”Ÿæ´»ä»‹è­·å‹ï¼‰',cat:'shisetsu',t:2,r1:.144,r2:.048,r3:.042},
  kaigo_hoken:{n:'ä»‹è­·è€äººä¿å¥æ–½è¨­ï¼ˆè€å¥ï¼‰',cat:'shisetsu',t:2,r1:.102,r2:.030,r3:.024},
  tanki_rouken:{n:'ã‚·ãƒ§ãƒ¼ãƒˆã‚¹ãƒ†ã‚¤ï¼ˆç™‚é¤Šå‹ãƒ»è€å¥ï¼‰',cat:'shisetsu',t:2,r1:.102,r2:.030,r3:.024},
  kaigo_iryouin:{n:'ä»‹è­·åŒ»ç™‚é™¢',cat:'shisetsu',t:2,r1:.078,r2:.018,r3:.012},
  tanki_iryouin:{n:'ã‚·ãƒ§ãƒ¼ãƒˆã‚¹ãƒ†ã‚¤ï¼ˆåŒ»ç™‚é™¢ï¼‰',cat:'shisetsu',t:2,r1:.078,r2:.018,r3:.012},
  sho_taki:{n:'å°è¦æ¨¡å¤šæ©Ÿèƒ½å‹å±…å®…ä»‹è­·',cat:'taki',t:2,r1:.138,r2:.054,r3:.048},
  kan_taki:{n:'çœ‹è­·å°è¦æ¨¡å¤šæ©Ÿèƒ½å‹å±…å®…ä»‹è­·',cat:'taki',t:2,r1:.114,r2:.036,r3:.030},
  houmon_kango:{n:'è¨ªå•çœ‹è­·',cat:'other',t:3,rate:.132},
  houmon_riha:{n:'è¨ªå•ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³',cat:'other',t:3,rate:.108},
  kyotaku_shien:{n:'å±…å®…ä»‹è­·æ”¯æ´ï¼ˆã‚±ã‚¢ãƒãƒï¼‰',cat:'other',t:3,rate:.150},
};
const S_SVC={
  kyotaku_kaigo:{n:'å±…å®…ä»‹è­·',cat:'houmon',rate:.127},
  judo_houmon:{n:'é‡åº¦è¨ªå•ä»‹è­·',cat:'houmon',rate:.127},
  dokou_engo:{n:'åŒè¡Œæ´è­·',cat:'houmon',rate:.127},
  koudo_engo:{n:'è¡Œå‹•æ´è­·',cat:'houmon',rate:.127},
  seikatsu_kaigo:{n:'ç”Ÿæ´»ä»‹è­·',cat:'nicchu',rate:.072},
  shuro_ikou:{n:'å°±åŠ´ç§»è¡Œæ”¯æ´',cat:'nicchu',rate:.055},
  shuro_a:{n:'å°±åŠ´ç¶™ç¶šæ”¯æ´Aå‹',cat:'nicchu',rate:.055},
  shuro_b:{n:'å°±åŠ´ç¶™ç¶šæ”¯æ´Bå‹',cat:'nicchu',rate:.055},
  gh_hokatsu:{n:'å…±åŒç”Ÿæ´»æ´åŠ©ï¼ˆåŒ…æ‹¬å‹ï¼‰',cat:'kyoju',rate:.094},
  gh_nicchu:{n:'å…±åŒç”Ÿæ´»æ´åŠ©ï¼ˆæ—¥ä¸­æ”¯æ´å‹ï¼‰',cat:'kyoju',rate:.094},
  gh_gaibu:{n:'å…±åŒç”Ÿæ´»æ´åŠ©ï¼ˆå¤–éƒ¨åˆ©ç”¨å‹ï¼‰',cat:'kyoju',rate:.094},
  shisetsu_nyusho:{n:'æ–½è¨­å…¥æ‰€æ”¯æ´',cat:'kyoju',rate:.136},
  tanki_nyusho:{n:'çŸ­æœŸå…¥æ‰€',cat:'kyoju',rate:.136},
  ryoyo_kaigo:{n:'ç™‚é¤Šä»‹è­·',cat:'kyoju',rate:.136},
  jidou_hattatsu:{n:'å…ç«¥ç™ºé”æ”¯æ´',cat:'jidou',rate:.096},
  houkago_day:{n:'æ”¾èª²å¾Œç­‰ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹',cat:'jidou',rate:.096},
  jiritsu_kinou:{n:'è‡ªç«‹è¨“ç·´ï¼ˆæ©Ÿèƒ½è¨“ç·´ï¼‰',cat:'sonota',rate:.166},
  jiritsu_seikatsu:{n:'è‡ªç«‹è¨“ç·´ï¼ˆç”Ÿæ´»è¨“ç·´ï¼‰',cat:'sonota',rate:.166},
  shuro_teichaku:{n:'å°±åŠ´å®šç€æ”¯æ´',cat:'sonota',rate:.055},
  jiritsu_enjo:{n:'è‡ªç«‹ç”Ÿæ´»æ´åŠ©',cat:'sonota',rate:.055},
};

// State
let G={field:null,kSel:[],sSel:[],q3k:'yes',q3s:'yes',offices:{},officeNames:{},results:{}};

// ===== INIT =====
function init(){
  const catMap={houmon:'cat_houmon',tsusho:'cat_tsusho',shisetsu:'cat_shisetsu',taki:'cat_taki',other:'cat_other'};
  for(const[k,v] of Object.entries(K_SVC)){
    const c=document.getElementById(catMap[v.cat]);
    if(c) c.innerHTML+=`<label class="svc-item"><input type="checkbox" value="${k}" onchange="updSel()">${v.n}</label>`;
  }
  const scatMap={houmon:'scat_houmon',nicchu:'scat_nicchu',kyoju:'scat_kyoju',jidou:'scat_jidou',sonota:'scat_sonota'};
  for(const[k,v] of Object.entries(S_SVC)){
    const c=document.getElementById(scatMap[v.cat]);
    if(c) c.innerHTML+=`<label class="svc-item"><input type="checkbox" value="${k}" onchange="updSel()">${v.n}</label>`;
  }
  document.querySelectorAll('input[name=q3k],input[name=q3s]').forEach(r=>r.addEventListener('change',updQ3));
}

function updQ3(){
  G.q3k=document.querySelector('input[name=q3k]:checked')?.value||'yes';
  G.q3s=document.querySelector('input[name=q3s]:checked')?.value||'yes';
  document.getElementById('q3maybe').style.display=(G.q3k==='maybe'||G.q3s==='maybe')?'block':'none';
}

// ===== STEP 0 =====
function selectQ1(){
  G.field=document.querySelector('input[name=q1]:checked')?.value;
  const k=G.field==='kaigo'||G.field==='both';
  const s=G.field==='shogai'||G.field==='both';
  document.getElementById('q2kaigo').style.display=k?'block':'none';
  document.getElementById('q2shogai').style.display=s?'block':'none';
  document.getElementById('q3area').style.display='block';
  document.getElementById('q3kArea').style.display=k?'block':'none';
  document.getElementById('q3sArea').style.display=s?'block':'none';
  document.getElementById('step0nav').style.display='flex';
  updSel();
}

function toggleJutaku(){
  document.getElementById('jutakuNotice').style.display=document.getElementById('jutakugata').checked?'block':'none';
}

function updSel(){
  G.kSel=[];G.sSel=[];
  document.querySelectorAll('#q2kaigo input[type=checkbox]:checked').forEach(e=>{if(e.value&&e.id!=='jutakugata')G.kSel.push(e.value);});
  document.querySelectorAll('#q2shogai input[type=checkbox]:checked').forEach(e=>{if(e.value)G.sSel.push(e.value);});
  buildGrouping();
}

function buildGrouping(){
  const all=[...G.kSel.map(k=>({id:k,name:(K_SVC[k]||{}).n||k,type:'k'})),...G.sSel.map(k=>({id:k,name:(S_SVC[k]||{}).n||k,type:'s'}))];
  const area=document.getElementById('q2c');
  if(all.length<2){area.style.display='none';G.offices={};autoAssignOffices(all);return;}
  area.style.display='block';
  // Calculate how many office options to show
  const maxOff=Math.min(all.length,6);
  const letters='ABCDEF';
  let h='';
  all.forEach((svc,i)=>{
    const cur=G.offices[svc.id]||'A';
    let opts='';
    for(let j=0;j<maxOff;j++) opts+=`<option value="${letters[j]}" ${cur===letters[j]?'selected':''}>${letters[j]}</option>`;
    h+=`<div class="grp-row"><span style="flex:1">${svc.type==='k'?'ğŸ¥':'â™¿'} ${svc.name}</span><select onchange="setOffice('${svc.id}',this.value)">${opts}</select></div>`;
  });
  document.getElementById('grpList').innerHTML=h;
  // Auto-assign if first time
  if(Object.keys(G.offices).length===0) autoAssignOffices(all);
  buildOfficeNames();
}

function autoAssignOffices(all){
  G.offices={};
  all.forEach(s=>{G.offices[s.id]='A';});
}

function setOffice(svcId,letter){
  G.offices[svcId]=letter;
  buildOfficeNames();
}

function buildOfficeNames(){
  const usedLetters=[...new Set(Object.values(G.offices))].sort();
  let h='<div style="margin-top:8px"><strong style="font-size:12px">äº‹æ¥­æ‰€åï¼ˆä»»æ„ï¼‰</strong></div>';
  usedLetters.forEach(l=>{
    const cur=G.officeNames[l]||'';
    h+=`<div class="fg" style="margin-top:4px"><label>äº‹æ¥­æ‰€${l}</label><input type="text" value="${cur}" placeholder="ä¾‹ï¼šâ—‹â—‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³" onchange="G.officeNames['${l}']=this.value" style="font-size:12px"></div>`;
  });
  document.getElementById('grpNames').innerHTML=h;
}

// ===== STEP 1 =====
function updateBaseLabel(){
  const bm=gv('baseMonth');
  const labels={12:'R7å¹´12æœˆåˆ†',1:'R8å¹´1æœˆåˆ†',2:'R8å¹´2æœˆåˆ†',3:'R8å¹´3æœˆåˆ†',est:'ç›´è¿‘æœˆï¼ˆæ¦‚ç®—ï¼‰'};
  const lb=labels[bm]||bm;
  const ek=document.getElementById('kBaseLabel');if(ek)ek.textContent=lb;
  const es=document.getElementById('sBaseLabel');if(es)es.textContent=lb;
}

function buildRevInputs(){
  // Kaigo
  const kc=document.getElementById('kaigoRevCard');
  if(G.kSel.length>0){
    kc.style.display='block';
    let h='';
    G.kSel.forEach(k=>{const s=K_SVC[k];if(!s)return;
      const rateStr=s.t===3?`äº¤ä»˜ç‡ ${(s.rate*100).toFixed(1)}%`:`äº¤ä»˜ç‡ â‘ ${(s.r1*100).toFixed(1)}% +â‘¡${(s.r2*100).toFixed(1)}% +â‘¢${(s.r3*100).toFixed(1)}%`;
      h+=`<div class="rev-row"><div><div class="rn">${s.n}</div><div class="rr">${rateStr}</div></div><div><input type="number" id="kr_${k}" placeholder="ä¸‡å††" min="0" step="1"></div></div>`;
    });
    document.getElementById('kaigoRevRows').innerHTML=h;
  }else{kc.style.display='none';}
  // Shogai
  const sc=document.getElementById('shogaiRevCard');
  if(G.sSel.length>0){
    sc.style.display='block';
    let h='';
    G.sSel.forEach(k=>{const s=S_SVC[k];if(!s)return;
      h+=`<div class="rev-row"><div><div class="rn">${s.n}</div><div class="rr">äº¤ä»˜ç‡ ${(s.rate*100).toFixed(1)}%</div></div><div><input type="number" id="sr_${k}" placeholder="ä¸‡å††" min="0" step="1"></div></div>`;
    });
    document.getElementById('shogaiRevRows').innerHTML=h;
  }else{sc.style.display='none';}
}

// ===== STEP 2 =====
function buildReqCards(){
  const hasK=G.kSel.length>0;
  const hasS=G.sSel.length>0;
  document.getElementById('kaigoReqCard').style.display=hasK?'block':'none';
  document.getElementById('shogaiReqCard').style.display=hasS?'block':'none';
  if(hasK) buildKaigoReqs();
  buildStaffInputs();
}

function buildKaigoReqs(){
  const hasFacility=G.kSel.some(k=>K_SVC[k]&&K_SVC[k].t===2);
  let h=`
    <div class="fg"><label>ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿é€£æºã‚·ã‚¹ãƒ†ãƒ </label>
      <select id="k_cp"><option value="yes">åŠ å…¥æ¸ˆã¿</option><option value="pledge">èª“ç´„äºˆå®š</option><option value="no">æœªåŠ å…¥</option></select>
      <div class="help">ã‚„ã•ã—ãè¨€ã†ã¨ï¼šã‚±ã‚¢ãƒãƒã¨ä»‹è­·äº‹æ¥­æ‰€ã®é–“ã§ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã‚„ã‚Šå–ã‚Šã™ã‚‹å›½ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ç¾åœ¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ–™ãŒç„¡æ–™ãªã®ã§ã€åŠ å…¥ã™ã‚‹ã ã‘ã§è£œåŠ©é‡‘ã®ä¸Šä¹—ã›ï¼ˆâ‘¡ï¼‰ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚</div>
    </div>`;
  if(hasFacility){
    h+=`<div class="fg"><label>ç”Ÿç”£æ€§å‘ä¸Šæ¨é€²ä½“åˆ¶åŠ ç®—ï¼ˆæ–½è¨­ç³»ã®ã¿ï¼‰</label>
      <select id="k_prod"><option value="no">æœªç®—å®š</option><option value="yes">â… åˆã¯â…¡ã‚’ç®—å®šä¸­</option><option value="pledge">èª“ç´„äºˆå®š</option></select>
      <div class="help">ã‚„ã•ã—ãè¨€ã†ã¨ï¼šICTæ´»ç”¨ã‚„æ¥­å‹™æ”¹å–„ã®ä½“åˆ¶ã‚’æ•´ãˆãŸæ–½è¨­ãŒç®—å®šã§ãã‚‹åŠ ç®—ã§ã™ã€‚</div>
    </div>`;
  }
  h+=`<div class="fg"><label>è·å ´ç’°å¢ƒæ”¹å–„ã®å–çµ„</label>
    <select id="k_env"><option value="yes">å®Ÿæ–½æ¸ˆã¿ or è¨ˆç”»ä¸­</option><option value="no">æœªå®Ÿæ–½</option></select>
    <div class="help">æ¥­å‹™ã®æ´—ã„å‡ºã— / æ”¹å–„ãƒãƒ¼ãƒ ã®ç«‹ã¡ä¸Šã’ / å½¹å‰²åˆ†æ‹…ã®æ˜ç¢ºåŒ– ã®ã„ãšã‚Œã‹1ã¤ã§OKã€‚â‘¡ã®è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚Œã°è‡ªå‹•å……è¶³ã€‚</div>
  </div>
  <div class="fg"><label>ç¤¾ä¼šç¦ç¥‰é€£æºæ¨é€²æ³•äººã¸ã®æ‰€å±</label>
    <select id="k_renkei"><option value="no">éæ‰€å±</option><option value="yes">æ‰€å±</option></select>
  </div>`;
  document.getElementById('kaigoReqRows').innerHTML=h;
  // Add è¡¨3 note if relevant services selected
  const hasT3=G.kSel.some(k=>K_SVC[k]&&K_SVC[k].t===3);
  if(hasT3){
    document.getElementById('kaigoReqRows').innerHTML+=`<div class="notice info" style="margin-top:8px">
      ğŸ“Œ <strong>è¡¨3ã‚µãƒ¼ãƒ“ã‚¹ã®è£œè¶³</strong><br>
      â”€ <strong>è¨ªå•çœ‹è­·ãƒ»è¨ªå•ãƒªãƒï¼š</strong>å‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šã¯ä¸è¦ã€‚CPé€£æºåŠ å…¥ or é€£æºæ¨é€²æ³•äººæ‰€å±ãŒè¦ä»¶ã€‚<br>
      â”€ <strong>å±…å®…ä»‹è­·æ”¯æ´ï¼š</strong>CPé€£æºã¯ä¸è¦ã€‚å‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šãŒè¦ä»¶ã€‚
    </div>`;
  }
}

function buildStaffInputs(){
  const allSvcs=[...G.kSel.map(k=>({id:k,name:(K_SVC[k]||{}).n,type:'k'})),...G.sSel.map(k=>({id:k,name:(S_SVC[k]||{}).n,type:'s'}))];
  if(allSvcs.length===1){
    G.offices[allSvcs[0].id]='A';
    G.officeNames['A']=G.officeNames['A']||'';
  }
  const officeMap={};
  allSvcs.forEach(s=>{const l=G.offices[s.id]||'A';if(!officeMap[l])officeMap[l]=[];officeMap[l].push(s);});
  let h='';
  Object.keys(officeMap).sort().forEach(l=>{
    const svcs=officeMap[l];
    const nm=G.officeNames[l]||('äº‹æ¥­æ‰€'+l);
    const svcNames=svcs.map(s=>(s.type==='k'?'ğŸ¥':'â™¿')+' '+s.name).join(' ï¼ ');
    h+=`<div class="office-card">
      <h3>ğŸ¢ ${nm}</h3>
      <div class="office-svcs">${svcNames}</div>
      <div class="fg"><label>ä»‹è­·ï¼ç¦ç¥‰è·å“¡æ•°ï¼ˆå¸¸å‹¤æ›ç®—ï¼‰</label><input type="number" id="staff_care_${l}" placeholder="äººæ•°" min="0" step="0.5"></div>
      <div class="fg"><label>ãã®ä»–è·å“¡æ•°ï¼ˆäº‹å‹™ãƒ»ç›¸è«‡å“¡ç­‰ï¼‰</label><input type="number" id="staff_other_${l}" placeholder="äººæ•°" min="0" step="0.5"></div>
    </div>`;
  });
  document.getElementById('staffInputArea').innerHTML=h;
}

// ===== STEP 3: CALCULATE =====
function calculate(){
  const cp=gv('k_cp');const prod=gv('k_prod');const env=gv('k_env');const renkei=gv('k_renkei');
  const hasCP=cp==='yes'||cp==='pledge';
  const hasProd=prod==='yes'||prod==='pledge';
  const hasEnv=env==='yes'||hasCP;
  const hasRenkei=renkei==='yes';
  const q3kOk=G.q3k==='yes'||G.q3k==='maybe'; // ä»‹è­·ã®å‡¦é‡æ”¹å–„åŠ ç®—

  // Build office map
  const allSvcs=[...G.kSel.map(k=>({id:k,type:'k'})),...G.sSel.map(k=>({id:k,type:'s'}))];
  const officeMap={};
  allSvcs.forEach(s=>{const l=G.offices[s.id]||'A';if(!officeMap[l])officeMap[l]=[];officeMap[l].push(s);});

  G.results={};let grandTotal=0;
  let html='';

  Object.keys(officeMap).sort().forEach(l=>{
    const svcs=officeMap[l];
    const nm=G.officeNames[l]||('äº‹æ¥­æ‰€'+l);
    const staffC=pf('staff_care_'+l);
    const staffO=pf('staff_other_'+l);
    let officeTotal=0;
    let rows='';

    svcs.forEach(svc=>{
      const rev=pf((svc.type==='k'?'kr_':'sr_')+svc.id)*10000;
      let sub=0;
      if(svc.type==='k'){
        const s=K_SVC[svc.id];if(!s)return;
        if(s.t===3){
          // è¡¨3: å±…å®…ä»‹è­·æ”¯æ´=å‡¦é‡æ”¹å–„åŠ ç®—ç®—å®šãŒè¦ä»¶ / è¨ªå•çœ‹è­·ãƒ»è¨ªå•ãƒªãƒ=CP or é€£æºæ¨é€²æ³•äºº
          let meets=false;
          if(svc.id==='kyotaku_shien') meets=q3kOk;
          else meets=(hasCP||hasRenkei);
          sub=meets?rev*s.rate:0;
          rows+=`<tr><td>ğŸ¥ ${s.n}</td><td colspan="2" style="text-align:right;font-weight:700">${fmt(sub)}å††${!meets?' <span style="color:var(--danger);font-size:10px">â€»è¦ä»¶æœªå……è¶³</span>':''}</td></tr>`;
        }else{
          const a1=rev*s.r1;
          const a2=(s.t===1?(hasCP||hasRenkei):(hasProd||hasCP||hasRenkei))?rev*s.r2:0;
          const a3=hasEnv?rev*s.r3:0;
          sub=a1+a2+a3;
          rows+=`<tr><td>ğŸ¥ ${s.n}</td><td style="text-align:right;font-size:11px">â‘ ${fmt(a1)} +â‘¡${fmt(a2)} +â‘¢${fmt(a3)}</td><td style="text-align:right;font-weight:700">${fmt(sub)}å††</td></tr>`;
        }
      }else{
        const s=S_SVC[svc.id];if(!s)return;
        sub=rev*s.rate;
        rows+=`<tr><td>â™¿ ${s.n}</td><td colspan="2" style="text-align:right;font-weight:700">${fmt(sub)}å††</td></tr>`;
      }
      officeTotal+=sub;
    });

    grandTotal+=officeTotal;
    const perCare=staffC>0?Math.round(officeTotal/staffC/6):0;
    G.results[l]={total:officeTotal,staffC,staffO,name:nm,svcs};

    html+=`<div class="office-card">
      <h3>ğŸ¢ ${nm}</h3>
      <table style="width:100%;border-collapse:collapse;font-size:12px">${rows}</table>
      <div class="office-total">äº‹æ¥­æ‰€${l} åˆè¨ˆï¼š${fmt(officeTotal)}å††ï¼ˆ6ãƒ¶æœˆï¼‰</div>
      ${staffC>0?`<div style="font-size:12px;color:var(--text2);text-align:center">ä»‹è­·/ç¦ç¥‰è·å“¡1äººã‚ãŸã‚Šæœˆé¡ç›®å®‰ï¼šç´„ <strong>${fmt(perCare)}å††</strong></div>`:''}
    </div>`;
  });

  html+=`<div class="results"><div style="text-align:center">
    <div style="font-size:12px;color:var(--text2)">ğŸ¯ è£œåŠ©é‡‘ æ³•äººåˆè¨ˆ</div>
    <div style="font-size:28px;font-weight:900;color:var(--kaigo)">${fmt(grandTotal)}å††</div>
    <div style="font-size:11px;color:var(--text3)">ï¼ˆ6ãƒ¶æœˆåˆ†ï¼‰</div>
  </div></div>`;

  html+=`<div class="notice warn">âš ï¸ äº‹æ¥­æ‰€é–“ã§ã®è£œåŠ©é‡‘ã®èé€šã¯ã§ãã¾ã›ã‚“ã€‚å„äº‹æ¥­æ‰€ã«äº¤ä»˜ã•ã‚ŒãŸè£œåŠ©é¡ã®ç¯„å›²å†…ã§é…åˆ†ã—ã¦ãã ã•ã„ã€‚ï¼ˆå‡ºå…¸ï¼šVol.1454 å®Ÿæ–½è¦ç¶± 7(1)â‘ ï¼‰</div>`;

  if(gv('baseMonth')==='est') html+=`<div class="notice danger">âš ï¸ ç›´è¿‘æœˆã®æ¦‚ç®—å€¤ã§ã®è©¦ç®—ã§ã™ã€‚åŸºæº–æœˆï¼ˆR7å¹´12æœˆï¼‰ã®ç¢ºå®šå€¤ã§å†è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</div>`;

  G.grandTotal=grandTotal;
  document.getElementById('resultArea').innerHTML=html;
}

// ===== STEP 4: DISTRIBUTION =====
function buildDistribution(){
  let html='';
  Object.keys(G.results).sort().forEach(l=>{
    const r=G.results[l];
    if(!r||r.total===0)return;
    html+=`<div class="office-card">
      <h3>ğŸ¢ ${r.name}ï¼ˆè£œåŠ©é‡‘ ${fmt(r.total)}å††ï¼‰</h3>
      <div class="dist-box">
        <div class="fg"><label>é…åˆ†æ–¹æ³•</label><select id="dm_${l}"><option value="lump">å…¨é¡ã‚’ä¸€æ™‚é‡‘ã§ä¸€æ‹¬æ”¯çµ¦</option><option value="monthly">æœˆé¡æ‰‹å½“ã§6ãƒ¶æœˆæŒ‰åˆ†</option><option value="mix">ä¸€æ™‚é‡‘ï¼‹æ‰‹å½“ã®çµ„åˆã›</option></select></div>
        <div class="fg"><label>é…åˆ†æ¯”ç‡ï¼ˆä»‹è­·/ç¦ç¥‰è·å“¡ : ãã®ä»–è·å“¡ï¼‰</label>
          <select id="dr_${l}" onchange="toggleCustomRatio('${l}')">
            <option value="70">ä»‹è­·/ç¦ç¥‰ 70% : ãã®ä»– 30%ï¼ˆæ¨å¥¨ï¼‰</option>
            <option value="100">ä»‹è­·/ç¦ç¥‰ 100%ï¼ˆå…¨é¡ï¼‰</option>
            <option value="50">ä»‹è­·/ç¦ç¥‰ 50% : ãã®ä»– 50%</option>
            <option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option>
          </select>
        </div>
        <div id="customRatio_${l}" style="display:none" class="fg">
          <label>ä»‹è­·/ç¦ç¥‰è·å“¡ã¸ã®é…åˆ†ç‡ï¼ˆ%ï¼‰</label>
          <input type="number" id="drCustom_${l}" placeholder="ä¾‹: 80" min="0" max="100" step="5" value="70">
          <div class="help">æ®‹ã‚ŠãŒãã®ä»–è·å“¡ã¸ã®é…åˆ†ç‡ã«ãªã‚Šã¾ã™</div>
        </div>
        <button class="btn-secondary" onclick="calcDist('${l}')">é…åˆ†ã‚’è¨ˆç®—ã™ã‚‹</button>
      </div>
      <div id="distResult_${l}"></div>
    </div>`;
  });
  document.getElementById('distArea').innerHTML=html;
}

function toggleCustomRatio(l){
  const v=gv('dr_'+l);
  document.getElementById('customRatio_'+l).style.display=v==='custom'?'block':'none';
}

function calcDist(l){
  const r=G.results[l];if(!r)return;
  const selVal=gv('dr_'+l);
  const ratio=selVal==='custom'?(parseInt(gv('drCustom_'+l))||70):parseInt(selVal)||70;
  const method=gv('dm_'+l);
  const burden=Math.round(r.total*0.15);
  const net=r.total-burden;
  const forCare=Math.round(net*ratio/100);
  const forOther=net-forCare;
  const perCare=r.staffC>0?Math.round(forCare/r.staffC):0;
  const perOther=r.staffO>0?Math.round(forOther/r.staffO):0;
  const isMonthly=method==='monthly';
  const divider=isMonthly?6:1;
  const label=isMonthly?'æœˆé¡':'ç·é¡';

  let warn='';
  if(perOther>0&&perCare>0&&perOther>perCare){
    warn=`<div class="notice warn" style="margin-top:8px">âš ï¸ã€Œãã®ä»–è·å“¡ã€ã®1äººã‚ãŸã‚Šé¡ãŒã€Œä»‹è­·/ç¦ç¥‰è·å“¡ã€ã‚’ä¸Šå›ã£ã¦ã„ã¾ã™ã€‚å®Ÿæ–½è¦ç¶±ã¯ã€Œä»‹è­·è·å“¡ã¸ã®é…åˆ†ã‚’åŸºæœ¬ã€ã¨ã—ã¦ã„ã¾ã™ã€‚åã‚Šã¨åˆ¤æ–­ã•ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚</div>`;
  }

  document.getElementById('distResult_'+l).innerHTML=`<div class="dist-result">
    <table>
      <tr><td>è£œåŠ©é‡‘åˆè¨ˆ</td><td style="text-align:right;font-weight:700">${fmt(r.total)}å††</td></tr>
      <tr><td>äº‹æ¥­ä¸»è² æ‹…æ¦‚ç®—ï¼ˆ15%ï¼‰</td><td style="text-align:right;color:var(--danger)">â–²${fmt(burden)}å††</td></tr>
      <tr><td>è·å“¡ã¸ã®æ”¯çµ¦å¯èƒ½é¡</td><td style="text-align:right" class="dr-total">${fmt(net)}å††</td></tr>
    </table>
    <table style="margin-top:8px">
      <tr style="font-size:11px;color:var(--text3)"><td></td><td>é…åˆ†é¡</td><td>äººæ•°</td><td>1äººã‚ãŸã‚Š${label}</td></tr>
      <tr><td>ä»‹è­·/ç¦ç¥‰</td><td>${fmt(forCare)}å††</td><td>${r.staffC}äºº</td><td style="font-weight:700">${fmt(Math.round(perCare/divider))}å††</td></tr>
      ${r.staffO>0?`<tr><td>ãã®ä»–</td><td>${fmt(forOther)}å††</td><td>${r.staffO}äºº</td><td>${fmt(Math.round(perOther/divider))}å††</td></tr>`:''}
    </table>
  </div>${warn}
  <div style="font-size:10px;color:var(--text3);margin-top:6px;line-height:1.5">
    â€» æ³•å®šç¦åˆ©è²»15%ã¯æ¦‚ç®—ã§ã™ã€‚æ­£ç¢ºãªç‡ã¯ç¤¾åŠ´å£«ã«ã”ç¢ºèªãã ã•ã„ã€‚<br>
    â€» é‡‘é¡ã¯ç¨å¼•å‰ã§ã™ã€‚æ‰€å¾—ç¨ãƒ»ä½æ°‘ç¨ãŒæºæ³‰å¾´åã•ã‚Œã¾ã™ã€‚
  </div>`;
}

// ===== STEP 5: TODO =====
function buildTodo(){
  const pat=document.querySelector('input[name=todoPat]:checked')?.value||'A';
  const isA=pat==='A';
  const hasK=G.kSel.length>0;const hasS=G.sSel.length>0;
  const cp=gv('k_cp');const hasJutaku=document.getElementById('jutakugata')?.checked;

  let items=[];
  // Prep
  items.push({phase:'æº–å‚™ãƒ•ã‚§ãƒ¼ã‚º',items:[]});
  items[0].items.push('åŸºæº–æœˆï¼ˆR7.12æœˆï¼‰ã®ã‚µãƒ¼ãƒ“ã‚¹åˆ¥å ±é…¬é¡ã‚’ç¢ºèªã™ã‚‹');
  if(hasK) items[0].items.push('ã€ä»‹è­·ã€‘å‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šçŠ¶æ³ã‚’ç¢ºèªã™ã‚‹');
  if(hasS) items[0].items.push('ã€éšœå®³ã€‘ç¦ç¥‰ãƒ»ä»‹è­·è·å“¡å‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šçŠ¶æ³ã‚’ç¢ºèªã™ã‚‹');
  if(hasK&&G.q3k==='no') items[0].items.push('ã€ä»‹è­·ã€‘å‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šã‚’èª“ç´„ã™ã‚‹æº–å‚™');
  if(hasS&&G.q3s==='no') items[0].items.push('ã€éšœå®³ã€‘å‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šã‚’èª“ç´„ã™ã‚‹æº–å‚™');
  if(hasK&&cp!=='yes') items[0].items.push('ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿é€£æºã‚·ã‚¹ãƒ†ãƒ ã®åŠ å…¥ã‚’æ¤œè¨ã™ã‚‹ï¼ˆç„¡æ–™ã§â‘¡â‘¢ãŒè¿½åŠ ï¼‰');
  items[0].items.push('è·å ´ç’°å¢ƒæ”¹å–„ã®å–çµ„ã‚’1ã¤é¸å®šã™ã‚‹ï¼ˆè¦‹ãˆã‚‹åŒ–/ä½“åˆ¶æ§‹ç¯‰/å½¹å‰²åˆ†æ‹…ï¼‰');
  items[0].items.push('é…åˆ†æ–¹é‡ã‚’æ±ºã‚ã‚‹ï¼ˆä¸€æ™‚é‡‘ or æ‰‹å½“ or æ··åˆï¼‰');
  items[0].items.push('å¯¾è±¡è·å“¡ã®ç¯„å›²ã‚’æ±ºã‚ã‚‹');
  if(hasJutaku) items[0].items.push('ä½å®…å‹æœ‰è€ï¼šæ–½è¨­å†…ã§æä¾›ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã«å ±é…¬é¡ã‚’åˆ†ã‘ã¦é›†è¨ˆã™ã‚‹');

  // Apply
  items.push({phase:`ç”³è«‹ãƒ•ã‚§ãƒ¼ã‚º â”€ ${isA?'2æœˆä¸­æ—¬ã€œ':'4æœˆä¸Šæ—¬ã€œ'}`,items:[]});
  items[1].items.push('è¨ˆç”»æ›¸ï¼ˆæ§˜å¼ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹');
  items[1].items.push('è¨ˆç”»æ›¸ã‚’ä½œæˆã™ã‚‹');
  items[1].items.push('æ³•äººå˜ä½ã§æ„›çŸ¥çœŒã«æå‡ºã™ã‚‹');
  items[1].items.push('å›½ä¿é€£ã¸ã®å£åº§æƒ…å ±æä¾›ã«åŒæ„ã™ã‚‹');

  // Execute
  items.push({phase:`å®Ÿæ–½ãƒ•ã‚§ãƒ¼ã‚º â”€ ${isA?'4æœˆã€œ':'6æœˆã€œ'}`,items:[]});
  items[2].items.push('äº¤ä»˜æ±ºå®šé€šçŸ¥ã‚’å—é ˜ã™ã‚‹');
  items[2].items.push('è·å“¡ã¸å‘¨çŸ¥ã™ã‚‹ï¼ˆå·»æœ«ã®èª¬æ˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ´»ç”¨ï¼‰');
  items[2].items.push('è³ƒé‡‘æ”¹å–„ã‚’å®Ÿæ–½ã™ã‚‹ï¼ˆä¸€æ™‚é‡‘æ”¯çµ¦ or æ‰‹å½“é–‹å§‹ï¼‰');

  // Report
  items.push({phase:`å ±å‘Šãƒ•ã‚§ãƒ¼ã‚º â”€ ${isA?'6ã€œ8æœˆ':'8ã€œ10æœˆ'}`,items:[]});
  items[3].items.push('å®Ÿç¸¾å ±å‘Šæ›¸ã‚’ä½œæˆã™ã‚‹ï¼ˆè£œåŠ©é¡ â‰¦ è³ƒé‡‘æ”¹å–„é¡ã‚’ç¢ºèªï¼‰');
  items[3].items.push('å®Ÿç¸¾å ±å‘Šæ›¸ã‚’æ„›çŸ¥çœŒã«æå‡ºã™ã‚‹');
  items[3].items.push('é–¢é€£æ›¸é¡ã‚’2å¹´é–“ä¿å­˜ã™ã‚‹');

  let h='';
  items.forEach(phase=>{
    h+=`<div class="card"><div class="todo-phase">${phase.phase}</div>`;
    phase.items.forEach(item=>{
      h+=`<div class="todo-item"><input type="checkbox" onchange="this.parentElement.classList.toggle('done')"><span>${item}</span></div>`;
    });
    h+='</div>';
  });
  document.getElementById('todoArea').innerHTML=h;
}

// ===== STEP 6: FAQ =====
const FAQS=[
  {q:'Q1. è£œåŠ©é‡‘ã¯ã„ã¤æŒ¯ã‚Šè¾¼ã¾ã‚Œã¾ã™ã‹ï¼Ÿ',a:'Aãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ2æœˆç”³è«‹ï¼‰ã§4æœˆé ƒã€Bãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ4æœˆç”³è«‹ï¼‰ã§6æœˆé ƒã§ã™ã€‚å›½ä¿é€£ã®ç™»éŒ²å£åº§ã«æ³•äººä¸€æ‹¬ã§æŒ¯ã‚Šè¾¼ã¾ã‚Œã¾ã™ã€‚',cat:'common'},
  {q:'Q2. å…¥é‡‘å‰ã«å…ˆã«ä¸€æ™‚é‡‘ã‚’æ‰•ã£ã¦ã‚‚å¤§ä¸ˆå¤«ï¼Ÿ',a:'ã¯ã„ã€‚åŸºæº–æœˆä»¥é™ã«å®Ÿæ–½ã—ãŸè³ƒé‡‘æ”¹å–„ã§ã‚ã‚Œã°ã€å…¥é‡‘å‰ã®ç«‹æ›¿æ”¯çµ¦ã‚‚å®Ÿç¸¾å ±å‘Šã®å¯¾è±¡ã«ã§ãã¾ã™ã€‚',cat:'common'},
  {q:'Q3. å…¨é¡ã‚’ä¸€æ™‚é‡‘ã§æ‰•ãˆã¾ã™ã‹ï¼Ÿ',a:'ã¯ã„ã€‚åšåŠ´çœã¯ã€Œä¸€æ™‚é‡‘ã‚„è‡¨æ™‚ã®æ‰‹å½“ã¨ã—ã¦å……ã¦ã‚‹ã“ã¨ã‚’æƒ³å®šã€ã¨æ˜è¨˜ã—ã¦ã„ã¾ã™ã€‚åŸºæœ¬çµ¦ã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚‚ã€Œä¸€æ¦‚ã«å¦¨ã’ãªã„ã€ã¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€æœ¬æ¥ã®æƒ³å®šã¯ä¸€æ™‚é‡‘ã§ã™ã€‚',cat:'common'},
  {q:'Q4. ãƒ‘ãƒ¼ãƒˆãƒ»éå¸¸å‹¤è·å“¡ã‚‚å¯¾è±¡ã§ã™ã‹ï¼Ÿ',a:'ã¯ã„ã€‚åŒä¸€äº‹æ¥­æ‰€ã§é›‡ç”¨ã—ã¦ã„ã‚‹è·å“¡ã§ã‚ã‚Œã°ã€é›‡ç”¨å½¢æ…‹ã‚’å•ã‚ãšå¯¾è±¡ã«ã§ãã¾ã™ã€‚',cat:'common'},
  {q:'Q5. æ´¾é£ç¤¾å“¡ã¯å¯¾è±¡ã§ã™ã‹ï¼Ÿ',a:'ã„ã„ãˆã€‚æ´¾é£ç¤¾å“¡ã¯æ´¾é£å…ƒäº‹æ¥­æ‰€ã®æ‰±ã„ã¨ãªã‚Šã€æ´¾é£å…ˆã®è£œåŠ©é‡‘å¯¾è±¡ã«ã¯å«ã‚ã‚‰ã‚Œã¾ã›ã‚“ã€‚',cat:'common'},
  {q:'Q6. æ³•äººæœ¬éƒ¨ã®äº‹å‹™è·å“¡ã¯å¯¾è±¡ã§ã™ã‹ï¼Ÿ',a:'è£œåŠ©é‡‘å¯¾è±¡ã®äº‹æ¥­æ‰€ã®æ¥­å‹™ã«å¾“äº‹ã—ã¦ã„ã‚‹ã¨åˆ¤æ–­ã§ãã‚‹å ´åˆã¯å«ã‚ã‚‰ã‚Œã¾ã™ã€‚',cat:'common'},
  {q:'Q7. é€€è·æ‰‹å½“ã«å……ã¦ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ',a:'ã„ã„ãˆã€‚å®Ÿæ–½è¦ç¶±ã§æ˜ç¢ºã«é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ã€‚',cat:'common'},
  {q:'Q8. ä½å®…å‹æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ã¯å¯¾è±¡ã§ã™ã‹ï¼Ÿ',a:'å»ºç‰©ãƒ»å±…ä½éƒ¨åˆ†ã¯å¯¾è±¡å¤–ã§ã™ã€‚ãŸã ã—å…¥å±…è€…ã«æä¾›ã—ã¦ã„ã‚‹è¨ªå•ä»‹è­·ãƒ»è¨ªå•çœ‹è­·ç­‰ã¯å¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚ç‰¹å®šæ–½è¨­ã®æŒ‡å®šã‚’å—ã‘ã¦ã„ã‚‹å ´åˆã¯ã€Œç‰¹å®šæ–½è¨­å…¥å±…è€…ç”Ÿæ´»ä»‹è­·ã€ã¨ã—ã¦å¯¾è±¡ã§ã™ã€‚',cat:'kaigo'},
  {q:'Q9. è¨ªå•çœ‹è­·ã¯å‡¦é‡æ”¹å–„åŠ ç®—ã®å¯¾è±¡å¤–ã§ã™ãŒï¼Ÿ',a:'ã“ã®è£œåŠ©é‡‘ã§ã¯ã€Œè¡¨3ã‚µãƒ¼ãƒ“ã‚¹ã€ã¨ã—ã¦åˆ¥æ ã§å¯¾è±¡ã§ã™ã€‚ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿é€£æºã‚·ã‚¹ãƒ†ãƒ ã¸ã®åŠ å…¥ç­‰ãŒè¦ä»¶ã§ã™ï¼ˆå‡¦é‡æ”¹å–„åŠ ç®—ã®ç®—å®šã¯ä¸è¦ï¼‰ã€‚',cat:'kaigo'},
  {q:'Q10. â‘¡â‘¢ã®ä¸Šä¹—ã›ã¯å¿…ãšå–ã‚‰ãªã„ã¨ãƒ€ãƒ¡ï¼Ÿ',a:'ã„ã„ãˆã€‚â‘ ã ã‘ã§ã‚‚ç”³è«‹ã§ãã¾ã™ã€‚ãŸã ã—â‘¡ã¯ã‚±ã‚¢ãƒ—ãƒ©ãƒ³é€£æºåŠ å…¥ï¼ˆç„¡æ–™ï¼‰ã§è¦ä»¶ã‚’æº€ãŸã›ã‚‹ãŸã‚ã€å–å¾—ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚',cat:'kaigo'},
  {q:'Q11. è¨ˆç”»ç›¸è«‡æ”¯æ´ã¯å¯¾è±¡ã§ã™ã‹ï¼Ÿ',a:'ã„ã„ãˆã€‚è¨ˆç”»ç›¸è«‡æ”¯æ´ã€éšœå®³å…ç›¸è«‡æ”¯æ´ã€åœ°åŸŸç›¸è«‡æ”¯æ´ï¼ˆç§»è¡Œãƒ»å®šç€ï¼‰ã¯å¯¾è±¡å¤–ã§ã™ã€‚',cat:'shogai'},
  {q:'Q12. ä»¤å’Œ7å¹´4æœˆä»¥é™ã«é–‹è¨­ã—ãŸäº‹æ¥­æ‰€ã¯ï¼Ÿ',a:'å¯¾è±¡å¤–ã§ã™ã€‚åŸºæº–æœˆã®æ™‚ç‚¹ã§ã‚µãƒ¼ãƒ“ã‚¹æä¾›å®Ÿç¸¾ãŒã‚ã‚‹ã“ã¨ãŒå‰æã§ã™ã€‚',cat:'shogai'},
  {q:'Q13. éšœå®³ç¦ç¥‰ã®è£œåŠ©é‡‘ã‚’è·å ´ç’°å¢ƒæ”¹å–„ã«ä½¿ãˆã‚‹ï¼Ÿ',a:'ã„ã„ãˆã€‚éšœå®³ç¦ç¥‰åˆ†é‡ã¯å…¨é¡ã‚’è³ƒé‡‘æ”¹å–„ã«å……ã¦ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»‹è­·åˆ†é‡ã¨ç•°ãªã‚Šã€è·å ´ç’°å¢ƒæ”¹å–„çµŒè²»ã¸ã®å……å½“ã¯èªã‚ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚',cat:'shogai'},
  {q:'Q14. æ³•äººå†…ã®è¤‡æ•°äº‹æ¥­æ‰€é–“ã§è£œåŠ©é‡‘é¡ã‚’èé€šã§ãã¾ã™ã‹ï¼Ÿ',a:'ã„ã„ãˆã€‚è£œåŠ©é‡‘ã¯äº‹æ¥­æ‰€ã”ã¨ã«ç®—å‡ºã•ã‚Œã€å®Ÿç¸¾å ±å‘Šã‚‚äº‹æ¥­æ‰€åˆ¥å€‹è¡¨ã§æå‡ºã—ã¾ã™ã€‚å®Ÿæ–½è¦ç¶±ã§ã¯ã€ŒåŒä¸€æ³•äººå†…ã®ä¸€éƒ¨ã®äº‹æ¥­æ‰€ã®ã¿ã«è³ƒé‡‘æ”¹å–„ã‚’é›†ä¸­ã•ã›ã‚‹ã“ã¨ã€ã‚’ã€Œè‘—ã—ãåã£ãŸé…åˆ†ã€ã®ä¾‹ã¨ã—ã¦æ˜ç¤ºã—ã¦ãŠã‚Šã€ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚å„äº‹æ¥­æ‰€ã«äº¤ä»˜ã•ã‚ŒãŸè£œåŠ©é¡ã®ç¯„å›²å†…ã§é…åˆ†ã—ã¦ãã ã•ã„ã€‚ï¼ˆå‡ºå…¸ï¼šVol.1454 å®Ÿæ–½è¦ç¶± 7(1)â‘ ï¼‰',cat:'common'},
];

function buildFaq(){
  const hasK=G.kSel.length>0;const hasS=G.sSel.length>0;
  let h='';
  FAQS.forEach((f,i)=>{
    if(f.cat==='kaigo'&&!hasK)return;
    if(f.cat==='shogai'&&!hasS)return;
    h+=`<div class="faq-item"><div class="faq-q" onclick="toggleFaq(${i})">${f.q}<span id="faqArr${i}">ï¼‹</span></div><div class="faq-a" id="faqA${i}">${f.a}</div></div>`;
  });
  document.getElementById('faqArea').innerHTML=h;
}

function toggleFaq(i){
  const a=document.getElementById('faqA'+i);
  const b=document.getElementById('faqArr'+i);
  a.classList.toggle('open');
  b.textContent=a.classList.contains('open')?'ï¼':'ï¼‹';
}

// ===== TEMPLATES =====
function showTpl(){
  const type=gv('tplType');
  const tpls={
    lump:`å‡¦é‡æ”¹å–„è³ƒä¸Šã’è£œåŠ©é‡‘ã«åŸºã¥ãä¸€æ™‚é‡‘ã®æ”¯çµ¦ã«ã¤ã„ã¦ï¼ˆãŠçŸ¥ã‚‰ã›ï¼‰

è·å“¡å„ä½

æ—¥é ƒã‚ˆã‚Šæ¥­å‹™ã«ã”å°½åŠ›ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

ã“ã®ãŸã³ã€å›½ã®ã€Œä»¤å’Œ7å¹´åº¦è£œæ­£äºˆç®—ï¼ˆåŒ»ç™‚ãƒ»ä»‹è­·ç­‰æ”¯æ´ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ã€ã«åŸºã¥ãå‡¦é‡æ”¹å–„è³ƒä¸Šã’è£œåŠ©é‡‘ã‚’æ´»ç”¨ã—ã€ä¸‹è¨˜ã®ã¨ãŠã‚Šä¸€æ™‚é‡‘ã‚’æ”¯çµ¦ã„ãŸã—ã¾ã™ã€‚

â–  æ”¯çµ¦æ™‚æœŸï¼šä»¤å’Œâ—‹å¹´â—‹æœˆâ—‹æ—¥
â–  å¯¾è±¡è€…ï¼šä»¤å’Œâ—‹å¹´â—‹æœˆâ—‹æ—¥æ™‚ç‚¹ã§å½“äº‹æ¥­æ‰€ã«åœ¨ç±ã™ã‚‹å…¨è·å“¡ï¼ˆãƒ‘ãƒ¼ãƒˆãƒ»éå¸¸å‹¤ã‚’å«ã‚€ï¼‰
â–  æ”¯çµ¦é¡ï¼š1äººã‚ãŸã‚Šâ—‹â—‹,â—‹â—‹â—‹å††ï¼ˆç¨å¼•å‰ï¼‰
ã€€â€»è·ç¨®ãƒ»å‹¤å‹™æ™‚é–“ã«å¿œã˜ã¦æŒ‰åˆ†ã‚ã‚Š
â–  è¶£æ—¨ï¼šå›½ã®ç·Šæ€¥çš„ãªè³ƒä¸Šã’æ”¯æ´ç­–ã«åŸºã¥ãã‚‚ã®

ãªãŠã€æœ¬ä¸€æ™‚é‡‘ã¯è£œåŠ©é‡‘ã‚’åŸè³‡ã¨ã—ã¦ãŠã‚Šã€å‡¦é‡æ”¹å–„åŠ ç®—ã«ã‚ˆã‚‹æ¯æœˆã®æ‰‹å½“ã¨ã¯åˆ¥æ ã§ã™ã€‚

ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€â—‹â—‹ï¼ˆæ‹…å½“è€…åï¼‰ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚

ä»¤å’Œâ—‹å¹´â—‹æœˆâ—‹æ—¥
â—‹â—‹â—‹â—‹ï¼ˆæ³•äººåï¼‰
â—‹â—‹â—‹â—‹ï¼ˆä»£è¡¨è€…åï¼‰`,
    monthly:`å‡¦é‡æ”¹å–„è³ƒä¸Šã’è£œåŠ©é‡‘ã«åŸºã¥ãè‡¨æ™‚æ‰‹å½“ã®æ”¯çµ¦ã«ã¤ã„ã¦ï¼ˆãŠçŸ¥ã‚‰ã›ï¼‰

è·å“¡å„ä½

æ—¥é ƒã‚ˆã‚Šæ¥­å‹™ã«ã”å°½åŠ›ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

ã“ã®ãŸã³ã€å›½ã®ã€Œä»¤å’Œ7å¹´åº¦è£œæ­£äºˆç®—ï¼ˆåŒ»ç™‚ãƒ»ä»‹è­·ç­‰æ”¯æ´ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ã€ã«åŸºã¥ãå‡¦é‡æ”¹å–„è³ƒä¸Šã’è£œåŠ©é‡‘ã‚’æ´»ç”¨ã—ã€ä¸‹è¨˜ã®ã¨ãŠã‚Šè‡¨æ™‚æ‰‹å½“ã‚’æ”¯çµ¦ã„ãŸã—ã¾ã™ã€‚

â–  æ”¯çµ¦æœŸé–“ï¼šä»¤å’Œâ—‹å¹´â—‹æœˆã€œä»¤å’Œâ—‹å¹´â—‹æœˆï¼ˆ6ãƒ¶æœˆé–“ï¼‰
â–  å¯¾è±¡è€…ï¼šï¼ˆåŒä¸Šï¼‰
â–  æ”¯çµ¦é¡ï¼š1äººã‚ãŸã‚Šæœˆé¡â—‹â—‹,â—‹â—‹â—‹å††ï¼ˆç¨å¼•å‰ï¼‰
ã€€â€»è·ç¨®ãƒ»å‹¤å‹™æ™‚é–“ã«å¿œã˜ã¦æŒ‰åˆ†ã‚ã‚Š
â–  æ”¯çµ¦æ–¹æ³•ï¼šæ¯æœˆã®çµ¦ä¸ã«ã€Œå‡¦é‡æ”¹å–„è‡¨æ™‚æ‰‹å½“ã€ã¨ã—ã¦ä¸Šä¹—ã›
â–  è¶£æ—¨ï¼šå›½ã®ç·Šæ€¥çš„ãªè³ƒä¸Šã’æ”¯æ´ç­–ã«åŸºã¥ãã‚‚ã®

ãªãŠã€æœ¬æ‰‹å½“ã¯è£œåŠ©é‡‘ã®äº¤ä»˜æœŸé–“ï¼ˆ6ãƒ¶æœˆï¼‰ã«é™ã£ãŸè‡¨æ™‚ã®æªç½®ã§ã‚ã‚Šã€æœŸé–“çµ‚äº†å¾Œã®ç¶™ç¶šã¯ãã®æ™‚ç‚¹ã®åˆ¶åº¦çŠ¶æ³ã«ã‚ˆã‚Šåˆ¤æ–­ã„ãŸã—ã¾ã™ã€‚

ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€â—‹â—‹ï¼ˆæ‹…å½“è€…åï¼‰ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚

ä»¤å’Œâ—‹å¹´â—‹æœˆâ—‹æ—¥
â—‹â—‹â—‹â—‹ï¼ˆæ³•äººåï¼‰
â—‹â—‹â—‹â—‹ï¼ˆä»£è¡¨è€…åï¼‰`
  };
  document.getElementById('tplArea').innerHTML=`<div class="tpl-box"><button class="copy-btn" onclick="copyTpl()">ã‚³ãƒ”ãƒ¼</button>${tpls[type]}</div>`;
}

function copyTpl(){
  const t=document.querySelector('.tpl-box').innerText.replace('ã‚³ãƒ”ãƒ¼','').trim();
  try{
    const ta=document.createElement('textarea');
    ta.value=t;ta.style.cssText='position:fixed;left:-9999px;top:-9999px';
    document.body.appendChild(ta);ta.select();
    document.execCommand('copy');document.body.removeChild(ta);
    const b=document.querySelector('.copy-btn');b.textContent='âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆ';setTimeout(()=>b.textContent='ã‚³ãƒ”ãƒ¼',2000);
  }catch(e){
    if(navigator.clipboard){navigator.clipboard.writeText(t).then(()=>{
      const b=document.querySelector('.copy-btn');b.textContent='âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆ';setTimeout(()=>b.textContent='ã‚³ãƒ”ãƒ¼',2000);
    }).catch(()=>alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’æ‰‹å‹•ã§é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚'));}
  }
}

// ===== PRINT =====
function printSection(type){
  const now=new Date();
  const ds=`${now.getFullYear()}/${String(now.getMonth()+1).padStart(2,'0')}/${String(now.getDate()).padStart(2,'0')}`;
  let content='';

  if(type==='result'){
    content=`<div class="print-hdr" style="display:block"><h1>å‡¦é‡æ”¹å–„ è³ƒä¸Šã’è£œåŠ©é‡‘ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ</h1><p>ä½œæˆæ—¥ï¼š${ds} ï½œ TRINITY PARTNERS</p></div>`;
    content+=document.getElementById('resultArea').innerHTML;
    // Add distribution results
    Object.keys(G.results).sort().forEach(l=>{
      const dr=document.getElementById('distResult_'+l);
      if(dr&&dr.innerHTML){
        content+=`<div style="margin-top:12px"><strong>ğŸ¢ ${G.results[l].name} â”€ é…åˆ†è¨­è¨ˆ</strong>${dr.innerHTML}</div>`;
      }
    });
    content+=`<div style="font-size:9px;color:#666;margin-top:12px;line-height:1.5;border-top:1px solid #ccc;padding-top:8px">
      â€» æœ¬ãƒ¬ãƒãƒ¼ãƒˆã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ¦‚ç®—ï¼‰ã§ã‚ã‚Šã€æ­£å¼ãªäº¤ä»˜é¡ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
      â€» æ­£å¼ãªäº¤ä»˜ç‡ã¯åšåŠ´çœå®Ÿæ–½è¦ç¶±ï¼ˆVol.1454 åˆ¥ç´™1ï¼‰ã‚’ã”ç¢ºèªãã ã•ã„ã€‚<br>
      â€» æ³•å®šç¦åˆ©è²»15%ã¯æ¦‚ç®—ã§ã™ã€‚æ­£ç¢ºãªç‡ã¯ç¤¾åŠ´å£«ã«ã”ç¢ºèªãã ã•ã„ã€‚</div>`;
  }else if(type==='todo'){
    const pat=document.querySelector('input[name=todoPat]:checked')?.value||'A';
    content=`<div class="print-hdr" style="display:block"><h1>å‡¦é‡æ”¹å–„ è³ƒä¸Šã’è£œåŠ©é‡‘ ã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆ</h1><p>ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š${pat} ï½œ ä½œæˆæ—¥ï¼š${ds}</p></div>`;
    content+=document.getElementById('todoArea').innerHTML;
  }else if(type==='faq'){
    content=`<div class="print-hdr" style="display:block"><h1>å‡¦é‡æ”¹å–„ è³ƒä¸Šã’è£œåŠ©é‡‘ FAQãƒ»å‚è€ƒè³‡æ–™</h1><p>ä½œæˆæ—¥ï¼š${ds} ï½œ TRINITY PARTNERS</p></div>`;
    // Expand all FAQ for printing
    let faqH='';
    FAQS.forEach(f=>{
      if(f.cat==='kaigo'&&G.kSel.length===0)return;
      if(f.cat==='shogai'&&G.sSel.length===0)return;
      faqH+=`<div style="margin-bottom:8px"><strong>${f.q}</strong><br><span style="color:#555">${f.a}</span></div>`;
    });
    content+=`<div style="margin-bottom:16px">${faqH}</div>`;
    content+=document.querySelector('.cmp').outerHTML;
    const tplBox=document.querySelector('.tpl-box');
    if(tplBox) content+=`<div style="margin-top:16px"><strong>â–  è·å“¡èª¬æ˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</strong>${tplBox.outerHTML}</div>`;
  }

  const target=document.getElementById('print'+type.charAt(0).toUpperCase()+type.slice(1));
  if(!target)return;
  target.innerHTML=content;
  target.classList.add('print-target');
  window.print();
  setTimeout(()=>{target.classList.remove('print-target');},500);
}

// ===== NAV =====
function goStep(n){
  if(n===1) buildRevInputs();
  if(n===2) buildReqCards();
  if(n===3) calculate();
  if(n===4) buildDistribution();
  if(n===5) buildTodo();
  if(n===6){buildFaq();showTpl();}
  document.querySelectorAll('.sec').forEach(s=>s.classList.remove('active'));
  document.getElementById('sec'+n).classList.add('active');
  document.querySelectorAll('.step-tab').forEach((t,i)=>{
    t.classList.remove('active','done');
    if(i===n) t.classList.add('active');
    else if(i<n) t.classList.add('done');
  });
  window.scrollTo({top:0,behavior:'smooth'});
}

// ===== UTILS =====
function gv(id){const e=document.getElementById(id);return e?e.value:'';}
function pf(id){return parseFloat(document.getElementById(id)?.value)||0}
function fmt(n){return isNaN(n)||n===0?'0':Math.round(n).toLocaleString('ja-JP')}
function toggleAcc(el){el.classList.toggle('open');el.nextElementSibling.classList.toggle('open')}

init();
</script>
</body>
</html>
